<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started with debiasLLMReporting • debiasLLMReporting</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with debiasLLMReporting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">debiasLLMReporting</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting Started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/real-data-example.html">Real Data Example</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting Started with debiasLLMReporting</h1>
            
      

      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>When using LLMs as judges to evaluate other models (e.g., comparing
outputs in pairwise comparisons), the LLM judge introduces measurement
error. This package provides methods to correct for this bias using a
small calibration sample where both human labels and LLM predictions are
available.</p>
<p>The key insight is that with a confusion matrix estimated from
calibration data, we can “debias” the prevalence estimate from the full
(unlabeled) test set.</p>
</div>
<div class="section level2">
<h2 id="problem-setup">Problem Setup<a class="anchor" aria-label="anchor" href="#problem-setup"></a>
</h2>
<p>Consider the task of estimating the <strong>win rate</strong> of
Model A versus Model B based on pairwise comparisons. The ground truth
is determined by human evaluators, but human labeling is expensive.
Instead, we use an LLM judge to evaluate a large number of
comparisons.</p>
<div class="section level3">
<h3 id="the-challenge">The Challenge<a class="anchor" aria-label="anchor" href="#the-challenge"></a>
</h3>
<p>Let <span class="math inline">\(Y \in \{0, 1\}\)</span> denote the
true human preference (1 = Model A wins) and <span class="math inline">\(\hat{Y} \in \{0, 1\}\)</span> denote the LLM
judge’s prediction. Our goal is to estimate:</p>
<p><span class="math display">\[\theta = P(Y = 1) = \text{true win rate
of Model A}\]</span></p>
<p>The naive approach is to use <span class="math inline">\(\hat{\theta}_{\text{naive}} =
\frac{1}{n}\sum_{i=1}^{n} \hat{Y}_i\)</span>, but this is
<strong>biased</strong> when the LLM judge makes errors.</p>
</div>
<div class="section level3">
<h3 id="misclassification-model">Misclassification Model<a class="anchor" aria-label="anchor" href="#misclassification-model"></a>
</h3>
<p>We model the LLM judge’s errors using two parameters:</p>
<ul>
<li>
<strong>Sensitivity</strong> <span class="math inline">\(q_1 =
P(\hat{Y} = 1 \mid Y = 1)\)</span>: probability the judge correctly
identifies Model A wins</li>
<li>
<strong>Specificity</strong> <span class="math inline">\(q_0 =
P(\hat{Y} = 0 \mid Y = 0)\)</span>: probability the judge correctly
identifies Model B wins</li>
</ul>
<p>When <span class="math inline">\(q_0, q_1 &lt; 1\)</span>, the naive
estimator is biased. For example, if the judge has a preference for
Model A (high <span class="math inline">\(q_1\)</span>, low <span class="math inline">\(q_0\)</span>), the naive estimate will
overestimate Model A’s true win rate.</p>
</div>
<div class="section level3">
<h3 id="the-solution-calibration-correction">The Solution: Calibration + Correction<a class="anchor" aria-label="anchor" href="#the-solution-calibration-correction"></a>
</h3>
<p>We assume access to:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Calibration set</strong> (<span class="math inline">\(m\)</span> samples): Both human labels <span class="math inline">\(Y\)</span> and judge predictions <span class="math inline">\(\hat{Y}\)</span> are observed</li>
<li>
<strong>Test set</strong> (<span class="math inline">\(n\)</span>
samples): Only judge predictions <span class="math inline">\(\hat{Y}\)</span> are observed</li>
</ol>
<p>From the calibration set, we estimate <span class="math inline">\(q_0\)</span> and <span class="math inline">\(q_1\)</span>. Then we apply correction methods to
obtain an unbiased estimate of <span class="math inline">\(\theta\)</span> with valid confidence
intervals.</p>
</div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yiqunchen.github.io/debias-llm-as-a-judge">debiasLLMReporting</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulated-example">Simulated Example<a class="anchor" aria-label="anchor" href="#simulated-example"></a>
</h2>
<p>Let’s simulate a scenario where:</p>
<ul>
<li>We want to estimate the true win rate of Model A vs Model B</li>
<li>An LLM judge provides predictions, but with imperfect accuracy</li>
<li>We have a small calibration set with human labels</li>
</ul>
<div class="section level3">
<h3 id="generate-data">Generate Data<a class="anchor" aria-label="anchor" href="#generate-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parameters</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span>          <span class="co"># Total samples</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">50</span>           <span class="co"># Calibration set size (10% labeled)</span></span>
<span><span class="va">theta_true</span> <span class="op">&lt;-</span> <span class="fl">0.6</span> <span class="co"># True win rate for Model A</span></span>
<span><span class="va">q0</span> <span class="op">&lt;-</span> <span class="fl">0.85</span>        <span class="co"># Specificity: P(judge says B | human says B)</span></span>
<span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="fl">0.80</span>        <span class="co"># Sensitivity: P(judge says A | human says A)</span></span>
<span></span>
<span><span class="co"># Generate true labels</span></span>
<span><span class="va">Y_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">theta_true</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate LLM judge predictions (with misclassification)</span></span>
<span><span class="va">Yhat_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>  <span class="va">Y_all</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">q1</span><span class="op">)</span>,       <span class="co"># True positives detected with prob q1</span></span>
<span>  <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">q0</span><span class="op">)</span>    <span class="co"># True negatives detected with prob q0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split into calibration and test sets</span></span>
<span><span class="va">idx_cal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">m</span><span class="op">)</span></span>
<span><span class="va">idx_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="va">idx_cal</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Y_cal</span> <span class="op">&lt;-</span> <span class="va">Y_all</span><span class="op">[</span><span class="va">idx_cal</span><span class="op">]</span></span>
<span><span class="va">Yhat_cal</span> <span class="op">&lt;-</span> <span class="va">Yhat_all</span><span class="op">[</span><span class="va">idx_cal</span><span class="op">]</span></span>
<span><span class="va">Yhat_test</span> <span class="op">&lt;-</span> <span class="va">Yhat_all</span><span class="op">[</span><span class="va">idx_test</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="apply-estimators">Apply Estimators<a class="anchor" aria-label="anchor" href="#apply-estimators"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Naive estimate (no correction)</span></span>
<span><span class="va">naive_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Yhat_test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Naive estimate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">naive_est</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Naive estimate: 0.56</span></span>
<span></span>
<span><span class="co"># 2. PPI (Prediction-Powered Inference)</span></span>
<span><span class="va">ppi_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ppi_point_and_ci.html">ppi_point_and_ci</a></span><span class="op">(</span></span>
<span>  Y_L <span class="op">=</span> <span class="va">Y_cal</span>,</span>
<span>  f_L <span class="op">=</span> <span class="va">Yhat_cal</span>,</span>
<span>  f_U <span class="op">=</span> <span class="va">Yhat_test</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. PPI++ (with optimized lambda)</span></span>
<span><span class="va">ppi_pp_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ppi_pp_point_and_ci_general.html">ppi_pp_point_and_ci_general</a></span><span class="op">(</span></span>
<span>  Y_L <span class="op">=</span> <span class="va">Y_cal</span>,</span>
<span>  f_L <span class="op">=</span> <span class="va">Yhat_cal</span>,</span>
<span>  f_U <span class="op">=</span> <span class="va">Yhat_test</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Rogan-Gladen (classical measurement error correction)</span></span>
<span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y_cal</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y_cal</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">q0_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Yhat_cal</span><span class="op">[</span><span class="va">Y_cal</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">q1_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Yhat_cal</span><span class="op">[</span><span class="va">Y_cal</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Yhat_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rg_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/llm_point_and_ci.html">llm_point_and_ci</a></span><span class="op">(</span></span>
<span>  p_hat <span class="op">=</span> <span class="va">p_hat</span>,</span>
<span>  q0_hat <span class="op">=</span> <span class="va">q0_hat</span>,</span>
<span>  q1_hat <span class="op">=</span> <span class="va">q1_hat</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Yhat_test</span><span class="op">)</span>,</span>
<span>  m0 <span class="op">=</span> <span class="va">m0</span>,</span>
<span>  m1 <span class="op">=</span> <span class="va">m1</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.10</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-results">Compare Results<a class="anchor" aria-label="anchor" href="#compare-results"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span>, <span class="st">"Naive"</span>, <span class="st">"PPI"</span>, <span class="st">"PPI++"</span>, <span class="st">"Rogan-Gladen"</span><span class="op">)</span>,</span>
<span>  Estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">theta_true</span>,</span>
<span>    <span class="va">naive_est</span>,</span>
<span>    <span class="va">ppi_result</span><span class="op">$</span><span class="va">theta</span>,</span>
<span>    <span class="va">ppi_pp_result</span><span class="op">$</span><span class="va">theta</span>,</span>
<span>    <span class="va">rg_result</span><span class="op">$</span><span class="va">theta</span></span>
<span>  <span class="op">)</span>,</span>
<span>  CI_Lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="va">ppi_result</span><span class="op">$</span><span class="va">ci_lower</span>, <span class="va">ppi_pp_result</span><span class="op">$</span><span class="va">ci_lower</span>, <span class="va">rg_result</span><span class="op">$</span><span class="va">ci_lower</span><span class="op">)</span>,</span>
<span>  CI_Upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="va">ppi_result</span><span class="op">$</span><span class="va">ci_upper</span>, <span class="va">ppi_pp_result</span><span class="op">$</span><span class="va">ci_upper</span>, <span class="va">rg_result</span><span class="op">$</span><span class="va">ci_upper</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">Bias</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">Estimate</span> <span class="op">-</span> <span class="va">theta_true</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">CI_Width</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">CI_Upper</span> <span class="op">-</span> <span class="va">results</span><span class="op">$</span><span class="va">CI_Lower</span></span>
<span><span class="va">results</span><span class="op">$</span><span class="va">Covers_True</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">CI_Lower</span> <span class="op">&lt;=</span> <span class="va">theta_true</span> <span class="op">&amp;</span> <span class="va">results</span><span class="op">$</span><span class="va">CI_Upper</span> <span class="op">&gt;=</span> <span class="va">theta_true</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="19%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="10%">
<col width="13%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th align="left">Method</th>
<th align="right">Estimate</th>
<th align="right">CI_Lower</th>
<th align="right">CI_Upper</th>
<th align="right">Bias</th>
<th align="right">CI_Width</th>
<th align="left">Covers_True</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">True</td>
<td align="right">0.600</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.000</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Naive</td>
<td align="right">0.560</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">-0.040</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">PPI</td>
<td align="right">0.640</td>
<td align="right">0.563</td>
<td align="right">0.711</td>
<td align="right">0.040</td>
<td align="right">0.148</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">PPI++</td>
<td align="right">0.613</td>
<td align="right">0.542</td>
<td align="right">0.679</td>
<td align="right">0.013</td>
<td align="right">0.137</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">Rogan-Gladen</td>
<td align="right">0.666</td>
<td align="right">0.542</td>
<td align="right">0.770</td>
<td align="right">0.066</td>
<td align="right">0.228</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.4.3</span></span>
<span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">Method</span> <span class="op">!=</span> <span class="st">"True"</span>, <span class="op">]</span></span>
<span><span class="va">plot_df</span><span class="op">$</span><span class="va">Method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plot_df</span><span class="op">$</span><span class="va">Method</span>,</span>
<span>                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Naive"</span>, <span class="st">"PPI"</span>, <span class="st">"PPI++"</span>, <span class="st">"Rogan-Gladen"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Method</span>, y <span class="op">=</span> <span class="va">Estimate</span>, color <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">CI_Lower</span>, ymax <span class="op">=</span> <span class="va">CI_Upper</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span>, linewidth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">theta_true</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">0.6</span>, y <span class="op">=</span> <span class="va">theta_true</span> <span class="op">+</span> <span class="fl">0.03</span>,</span>
<span>           label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"True ="</span>, <span class="va">theta_true</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Naive"</span> <span class="op">=</span> <span class="st">"#525252"</span>,</span>
<span>    <span class="st">"PPI"</span> <span class="op">=</span> <span class="st">"#1B9E77"</span>,</span>
<span>    <span class="st">"PPI++"</span> <span class="op">=</span> <span class="st">"#D95F02"</span>,</span>
<span>    <span class="st">"Rogan-Gladen"</span> <span class="op">=</span> <span class="st">"#7570B3"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Win Rate Estimation with Measurement Error Correction"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"N = "</span>, <span class="va">N</span>, <span class="st">", m = "</span>, <span class="va">m</span>, <span class="st">" ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">m</span><span class="op">/</span><span class="va">N</span><span class="op">)</span>, <span class="st">"% labeled)"</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Estimated Win Rate"</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/plot-results-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="key-takeaways">Key Takeaways<a class="anchor" aria-label="anchor" href="#key-takeaways"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<strong>Naive estimates are biased</strong> when the LLM judge has
imperfect accuracy</li>
<li>
<strong>PPI</strong> uses the calibration residuals to correct the
bias</li>
<li>
<strong>PPI++</strong> adaptively weights the correction to minimize
variance</li>
<li>
<strong>Rogan-Gladen</strong> uses the classical epidemiological
approach based on sensitivity/specificity</li>
</ol>
<p>All corrected methods aim to provide valid confidence intervals with
nominal coverage, while the naive estimate’s CI will not cover the true
value when there’s systematic bias.</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>See the <a href="real-data-example.html">Real Data Example</a>
vignette for applying these methods to actual LLM judge evaluations.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://yiqunchen.github.io/" class="external-link">Yiqun Chen</a>, <a href="https://github.com/Raymond2Moran" class="external-link">Moran Guo</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
